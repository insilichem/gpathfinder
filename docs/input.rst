.. GPathFinder: Identification of ligand binding pathways 
.. by a multi-objective genetic algorithm

   https://github.com/insilichem/gpathfinder

   Copyright 2019 José-Emilio Sánchez Aparicio, Giuseppe Sciortino,
   Daniel Villadrich Herrmannsdoerfer, Pablo Orenes Chueca, 
   Jaime Rodríguez-Guerra Pedregal and Jean-Didier Maréchal
   
   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

.. _input:

===========
Input files
===========

GPathFinder needs the previous preparation of three mandatory input files:

- A `.yaml` file with the configuration of the calculation.
- A `.mol2` file containing the 3D structure of the ligand molecule.
- A `.mol2` file containing the 3D structure of the receptor molecule.

If you are considering to minimize the sample structures generated by Normal Mode Analysis for the global motions of the receptor, and your receptor has non-standard residues, you will also need a `.prmtop` file with the receptor topology and the parametrization of such non-standard residues.

`.yaml` configuration file
==========================

GPathFinder uses a YAML-formatted input file for setting up the calculation. YAML is a human-readable serialization format, already implemented in a broad range of languages. Input files must contain these five sections:

- **output**. Project options. Configure it to your liking
- **ga**. Genetic algorithm configuration. Normally, you don't have to touch this, except maybe the number of generations and population size.
- **similarity**. The similarity function to compare potentially redundant solutions.
- **genes**. List of descriptors used to define an individual
- **objectives**. The list of functions that will evaluate your individuals.

Normally, you can start from one of our standard input files, where Genetic Algorithm parameters have been set to appropiate values for a general case. You should choose the input file depending on the following:

- What kind of experiment you want to perform: discover (un)binding pathways or analyze a known pathway (initial and final points given in advance).
- If you want to minimize the receptor samples before starting the actual calculation or not.
- What method you will use to evaluate the solutions (clashes, vina, smina).

.. csv-table::
   :header: "Link", "Use", "Minimization", "Clashes", "Vina", "Smina"
   :widths: 15, 30, 25, 10, 10, 10

   "`Input file 1 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/unbinding_clashes.yaml>`_", "Discover unbinding pathways", "No", "Yes", "No", "No"
   "`Input file 2 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/unbinding_clashes_vina.yaml>`_", "Discover unbinding pathways", "No", "Yes", "Yes", "No"
   "`Input file 3 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/unbinding_clashes_vina_minimize.yaml>`_", "Discover unbinding pathways", "Yes", "Yes", "Yes", "No"
   "`Input file 4 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/unbinding_clashes_smina.yaml>`_", "Discover unbinding pathways", "No", "Yes", "No", "Yes"
   "`Input file 5 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/unbinding_clashes_smina_minimize.yaml>`_", "Discover unbinding pathways", "Yes", "Yes", "No", "Yes"
   "`Input file 6 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/binding_clashes.yaml>`_", "Discover binding pathways", "No", "Yes", "No", "No"
   "`Input file 7 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/binding_clashes_vina.yaml>`_", "Discover binding pathways", "No", "Yes", "Yes", "No"
   "`Input file 8 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/binding_clashes_vina_minimize.yaml>`_", "Discover binding pathways", "Yes", "Yes", "Yes", "No"
   "`Input file 9 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/binding_clashes_smina.yaml>`_", "Discover binding pathways", "No", "Yes", "No", "Yes"
   "`Input file 10 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/binding_clashes_smina_minimize.yaml>`_", "Discover binding pathways", "Yes", "Yes", "No", "Yes"
   "`Input file 11 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/analyze_clashes.yaml>`_", "Analyze a known pathway", "No", "Yes", "No", "No"
   "`Input file 12 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/analyze_clashes_vina.yaml>`_", "Analyze a known pathway", "No", "Yes", "Yes", "No"
   "`Input file 13 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/analyze_clashes_vina_minimize.yaml>`_", "Analyze a known pathway", "Yes", "Yes", "Yes", "No"
   "`Input file 14 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/analyze_clashes_smina.yaml>`_", "Analyze a known pathway", "No", "Yes", "No", "Yes"
   "`Input file 15 <https://raw.githubusercontent.com/insilichem/gpathfinder/master/examples/input_files/analyze_clashes_smina_minimize.yaml>`_", "Analyze a known pathway", "Yes", "Yes", "No", "Yes"
 
If you want to deepen the knowledge of the different parameters and fine-tune the input file, you can follow the tutorial :ref:`tutorial-input`

There is also a list of all the parameters and their default values in :ref:`parameters`

`.mol2` files for ligand and receptor
=====================================

A typical workflow to prepare the two files for the ligand and receptor molecules starts from a `.pdb` structure of the `Protein Data Bank <https://www.rcsb.org/>`_. Of course, you can also use your own ligand and/or receptor files. For example, you can test a different ligand from the crystallographic one, or a conformation of the receptor obtained from a Molecular Dynamics simulation.

The requirements for the receptor file are:

- Small molecules that are not essential to consider in the calculation (like solvent molecules) should be removed.
- Alternative locations for residues (i.e. rotamers) should be removed. Only one conformation for each residue is allowed.
- In the case of clashes evaluation, it is not necessary to add Hydrogens if the user doesn't want to consider them.
- In the case of clashes+vina evaluation, adding Hydrogens is mandatory.
- In the case of minimizing the NMA samples, you have to take special care of terminal residues correctness and repair possible missing residues in your structure. Otherwise, OpenMM (in charge of the minimization) will complain and the calculation will be stopped.

The requirements for the ligand file are:

- In the case of unbinding pathway discovery, it is recommended that the 3D coordinates correspond to the binded position. Otherwise, the center of the binding site should be indicated explicitly in the `.yaml` configuration file (parameter ``gaudi.genes.path.origin``).
- In the case of clashes evaluation, it is not necessary to add Hydrogens if the user doesn't want to consider them.
- In the case of clashes+vina evaluation, adding Hydrogens is mandatory.

A tutorial on how to generate `.mol2` files using UCSF Chimera starting from a crystallographic structure of the PDB is provided in :ref:`tutorial-mol2`
